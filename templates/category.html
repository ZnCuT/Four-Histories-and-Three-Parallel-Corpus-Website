<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>{{ category.title }} — {{ book.title }}</title>
    <link rel="icon" type="image/png" sizes="32x32" href="/static/book-icon.png">
    <link rel="stylesheet" href="/static/style.css">
  </head>
  <body>
    <!-- 导航栏（独立于主容器） -->
    <nav class="main-nav">
      <div class="nav-container">
        <div class="nav-brand">
          <a href="/">四史三平行语料库</a>
        </div>
        
        <div class="nav-books">
          {% for nav_book in books %}
          <div class="nav-book-dropdown">
            <button class="nav-book-btn">{{ nav_book.title }}</button>
            <div class="nav-dropdown-content">
              {% for nav_category in nav_book.categories %}
              <a href="/book/{{ nav_book.id }}/{{ nav_category.id }}/">{{ nav_category.title }}</a>
              {% endfor %}
            </div>
          </div>
          {% endfor %}
        </div>
        
        <div class="nav-search">
          <form action="/search" method="GET" class="search-form">
            <input type="text" name="q" placeholder="搜索篇目或句子..." class="search-input">
            <select name="scope" class="search-scope">
              <option value="all">全部</option>
              <option value="title">篇目</option>
              <option value="content">内容</option>
            </select>
            <button type="submit" class="search-btn">搜索</button>
          </form>
        </div>
      </div>
    </nav>

    <div class="container">
      <header>
        <h1>{{ book.title }} — {{ category.title }}</h1>
      </header>

      <main>
        <div class="chapter-list">
          {% for chapter in category.chapters %}
          <div class="chapter-item">
            <a href="/book/{{ book.id }}/{{ category.id }}/chapter/{{ chapter.id }}/">
              <span class="chapter-number">第{{ chapter.id }}章</span>
              <span class="chapter-title">{{ chapter.title }}</span>
            </a>
          </div>
          {% endfor %}
        </div>
      </main>

      <nav class="category-nav">
        <a href="/book/{{ book.id }}/">← 返回{{ book.title }}分类列表</a>
        <a href="/">← 返回首页</a>
      </nav>

      <footer>
        <small>共{{ category.chapters|length }}章</small>
      </footer>
    </div>

    <script>
      // 导航菜单功能
      document.addEventListener('DOMContentLoaded', function() {
        const dropdowns = document.querySelectorAll('.nav-book-dropdown');
        
        dropdowns.forEach(dropdown => {
          const btn = dropdown.querySelector('.nav-book-btn');
          const content = dropdown.querySelector('.nav-dropdown-content');
          
          btn.addEventListener('click', function(e) {
            e.preventDefault();
            // 关闭其他下拉菜单
            dropdowns.forEach(other => {
              if (other !== dropdown) {
                other.querySelector('.nav-dropdown-content').style.display = 'none';
              }
            });
            // 切换当前下拉菜单
            content.style.display = content.style.display === 'block' ? 'none' : 'block';
          });
        });
        
        // 点击其他地方关闭下拉菜单
        document.addEventListener('click', function(e) {
          if (!e.target.closest('.nav-book-dropdown')) {
            dropdowns.forEach(dropdown => {
              dropdown.querySelector('.nav-dropdown-content').style.display = 'none';
            });
          }
        });
      });
    </script>
  </body>
</html>